<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learnify â€¢ Online Learning Platform</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Feather Icons for UI elements -->
    <script src="https://unpkg.com/feather-icons"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* Dark Gray */
            color: #d1d5db; /* Light Gray */
        }
        .course-card {
            background-color: #1f2937;
            border: 1px solid #374151;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .course-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
        }
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }
        /* Custom scrollbar for lesson list */
        .lesson-list::-webkit-scrollbar { width: 6px; }
        .lesson-list::-webkit-scrollbar-track { background: #1f2937; }
        .lesson-list::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 3px;}
        .lesson-list::-webkit-scrollbar-thumb:hover { background: #6b7280; }
    </style>
</head>
<body class="antialiased">

    <!-- App Container -->
    <div id="app-container">

        <!-- Header -->
        <header class="bg-gray-900/80 backdrop-blur-md sticky top-0 z-50 border-b border-gray-700">
            <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
                <a href="#" id="home-link" class="text-2xl font-bold text-white flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-indigo-400"><path d="M12 2L2 7l10 5 10-5-10-5z"></path><path d="M2 17l10 5 10-5"></path><path d="M2 12l10 5 10-5"></path></svg>
                    <span>Learnify</span>
                </a>
                <div id="user-actions">
                    <!-- This will be replaced by user profile or login button -->
                </div>
            </nav>
        </header>

        <main id="main-content" class="container mx-auto px-6 py-10">
            <!-- Content will be dynamically rendered here -->
        </main>
        
    </div>

    <!-- Auth Modal (Login/Signup) -->
    <div id="auth-modal" class="fixed inset-0 z-50 flex items-center justify-center modal-backdrop hidden">
        <div class="bg-gray-800 w-full max-w-md p-8 rounded-2xl shadow-xl border border-gray-700">
            <div id="login-view">
                <h2 class="text-3xl font-bold text-white text-center mb-6">Welcome Back</h2>
                <form id="login-form" class="space-y-4">
                    <input type="email" id="login-email" placeholder="Email" class="w-full bg-gray-700 text-white p-3 rounded-lg outline-none focus:ring-2 focus:ring-indigo-500" required>
                    <input type="password" id="login-password" placeholder="Password" class="w-full bg-gray-700 text-white p-3 rounded-lg outline-none focus:ring-2 focus:ring-indigo-500" required>
                    <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-lg transition-colors">Login</button>
                    <p id="login-error" class="text-red-400 text-sm text-center h-4"></p>
                </form>
                <p class="text-center text-gray-400 mt-4">Don't have an account? <a href="#" id="show-signup" class="text-indigo-400 hover:underline">Sign Up</a></p>
            </div>
            <div id="signup-view" class="hidden">
                <h2 class="text-3xl font-bold text-white text-center mb-6">Create Account</h2>
                <form id="signup-form" class="space-y-4">
                    <input type="email" id="signup-email" placeholder="Email" class="w-full bg-gray-700 text-white p-3 rounded-lg outline-none focus:ring-2 focus:ring-indigo-500" required>
                    <input type="password" id="signup-password" placeholder="Password (min. 6 characters)" class="w-full bg-gray-700 text-white p-3 rounded-lg outline-none focus:ring-2 focus:ring-indigo-500" required>
                    <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-lg transition-colors">Create Account</button>
                     <p id="signup-error" class="text-red-400 text-sm text-center h-4"></p>
                </form>
                <p class="text-center text-gray-400 mt-4">Already have an account? <a href="#" id="show-login" class="text-indigo-400 hover:underline">Login</a></p>
            </div>
             <button id="close-modal" class="absolute top-4 right-4 text-gray-500 hover:text-white">&times;</button>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // --- 1. FIREBASE CONFIG & INITIALIZATION ---
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY", // Replace with your Firebase config
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        let currentUser = null;
        let userProgress = {};

        // --- 2. MOCK DATA ---
        const courseData = {
            id: 'web-dev-101',
            title: 'Modern Web Development Bootcamp',
            description: 'Master HTML, CSS, JavaScript, and modern frameworks to build stunning, responsive websites from scratch.',
            instructor: 'Dr. Evelyn Reed',
            lessons: [
                { id: 'l1', title: 'Introduction to HTML5', duration: '12:45', videoUrl: 'https://www.youtube.com/embed/kUMe1FH4CHE' },
                { id: 'l2', title: 'Styling with CSS3', duration: '25:10', videoUrl: 'https://www.youtube.com/embed/kUMe1FH4CHE' },
                { id: 'l3', title: 'JavaScript Fundamentals', duration: '45:30', videoUrl: 'https://www.youtube.com/embed/kUMe1FH4CHE', quiz: {
                    questions: [
                        { q: "What does 'DOM' stand for?", a: ["Document Object Model", "Data Object Model", "Dynamic Object Module"], correct: 0 },
                        { q: "Which keyword is used to declare a constant variable?", a: ["var", "let", "const"], correct: 2 }
                    ]
                }},
                { id: 'l4', title: 'Advanced CSS: Flexbox & Grid', duration: '35:55', videoUrl: 'https://www.youtube.com/embed/kUMe1FH4CHE' },
            ]
        };

        // --- 3. UI RENDERING LOGIC ---
        const mainContent = document.getElementById('main-content');
        const userActions = document.getElementById('user-actions');
        
        const renderDashboard = () => {
            mainContent.innerHTML = `
                <section class="text-center mb-12">
                    <h2 class="text-4xl md:text-5xl font-bold text-white leading-tight">Your Learning Journey</h2>
                    <p class="mt-4 text-lg text-gray-400 max-w-2xl mx-auto">Welcome back! Continue learning where you left off or discover new courses.</p>
                </section>
                <div class="course-card rounded-2xl overflow-hidden cursor-pointer" id="course-${courseData.id}">
                    <img src="https://placehold.co/800x400/111827/374151?text=Web+Development" class="w-full h-56 object-cover">
                    <div class="p-8">
                        <h3 class="text-2xl font-bold text-white mb-2">${courseData.title}</h3>
                        <p class="text-gray-400 mb-4">${courseData.description}</p>
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-gray-400">Instructor: ${courseData.instructor}</span>
                            <span class="font-semibold text-indigo-400">View Course &rarr;</span>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById(`course-${courseData.id}`).addEventListener('click', () => renderCourseView(courseData));
        };
        
        const renderCourseView = (course) => {
            mainContent.innerHTML = `
                <div class="grid lg:grid-cols-3 gap-8">
                    <!-- Main Content: Video Player & Quiz -->
                    <div class="lg:col-span-2 bg-gray-900 rounded-2xl p-6">
                        <div id="video-player-container" class="aspect-video mb-6">
                            <!-- Video will be loaded here -->
                        </div>
                        <h2 id="lesson-title" class="text-3xl font-bold text-white mb-2"></h2>
                        <p class="text-gray-400 mb-6">Select a lesson to begin.</p>
                        <div id="quiz-container" class="hidden"></div>
                    </div>
                    <!-- Sidebar: Lesson List -->
                    <div class="bg-gray-900 rounded-2xl p-4">
                        <h3 class="text-xl font-bold text-white mb-4 px-2">Course Content</h3>
                        <ul id="lesson-list-ui" class="space-y-2 lesson-list max-h-[60vh] overflow-y-auto pr-2">
                           ${course.lessons.map(lesson => `
                                <li data-lesson-id="${lesson.id}" class="lesson-item flex justify-between items-center p-3 rounded-lg cursor-pointer hover:bg-gray-800 transition-colors">
                                    <div class="flex items-center gap-4">
                                        <div id="status-${lesson.id}" class="w-5 h-5 rounded-full border-2 border-gray-600 flex items-center justify-center">
                                           <!-- completion status icon -->
                                        </div>
                                        <div>
                                            <p class="font-semibold text-white">${lesson.title}</p>
                                            <p class="text-xs text-gray-400">${lesson.duration}</p>
                                        </div>
                                    </div>
                                    <i data-feather="play-circle" class="text-gray-500"></i>
                                </li>
                           `).join('')}
                        </ul>
                    </div>
                </div>
            `;
            feather.replace();
            attachLessonListeners(course);
            updateProgressUI(course.lessons);
        };

        // --- 4. APPLICATION LOGIC ---
        
        const attachLessonListeners = (course) => {
            document.querySelectorAll('.lesson-item').forEach(item => {
                item.addEventListener('click', () => {
                    const lessonId = item.dataset.lessonId;
                    const lesson = course.lessons.find(l => l.id === lessonId);
                    playLesson(lesson);
                });
            });
        };

        const playLesson = (lesson) => {
            document.getElementById('video-player-container').innerHTML = `<iframe class="w-full h-full rounded-lg" src="${lesson.videoUrl}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
            document.getElementById('lesson-title').textContent = lesson.title;
            
            const quizContainer = document.getElementById('quiz-container');
            if (lesson.quiz) {
                renderQuiz(lesson);
                quizContainer.classList.remove('hidden');
            } else {
                quizContainer.classList.add('hidden');
                markLessonComplete(lesson.id);
            }
        };

        const renderQuiz = (lesson) => {
            const quizContainer = document.getElementById('quiz-container');
            const score = userProgress[lesson.id]?.score;

            if (score !== undefined) {
                 quizContainer.innerHTML = `<div class="bg-gray-800 p-6 rounded-lg mt-6">
                    <h3 class="text-xl font-bold text-white">Quiz Completed!</h3>
                    <p class="text-lg text-indigo-400 font-semibold">Your Score: ${score} / ${lesson.quiz.questions.length}</p>
                 </div>`;
                 return;
            }

            quizContainer.innerHTML = `
                <div class="bg-gray-800 p-6 rounded-lg mt-6">
                    <h3 class="text-xl font-bold text-white mb-4">Test Your Knowledge</h3>
                    <form id="quiz-form">
                       ${lesson.quiz.questions.map((q, index) => `
                           <div class="mb-4">
                                <p class="font-semibold mb-2">${index + 1}. ${q.q}</p>
                                ${q.a.map((option, i) => `
                                    <label class="block p-2 rounded-md hover:bg-gray-700">
                                        <input type="radio" name="q${index}" value="${i}" class="mr-2"> ${option}
                                    </label>
                                `).join('')}
                           </div>
                       `).join('')}
                       <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg">Submit Answers</button>
                    </form>
                </div>
            `;
            document.getElementById('quiz-form').addEventListener('submit', (e) => {
                e.preventDefault();
                checkQuiz(lesson, e.target);
            });
        };

        const checkQuiz = (lesson, form) => {
            let score = 0;
            lesson.quiz.questions.forEach((q, index) => {
                const selected = form.querySelector(`input[name="q${index}"]:checked`);
                if (selected && parseInt(selected.value) === q.correct) {
                    score++;
                }
            });
            markLessonComplete(lesson.id, score);
            renderQuiz(lesson); // Re-render to show score
        };

        const markLessonComplete = async (lessonId, score) => {
            if (!currentUser) return;
            userProgress[lessonId] = { completed: true };
            if (score !== undefined) {
                userProgress[lessonId].score = score;
            }

            try {
                await setDoc(doc(db, "userProgress", currentUser.uid), userProgress, { merge: true });
                updateProgressUI(courseData.lessons);
            } catch (e) {
                console.error("Error saving progress: ", e);
            }
        };
        
        const updateProgressUI = (lessons) => {
            lessons.forEach(lesson => {
                const statusEl = document.getElementById(`status-${lesson.id}`);
                if (userProgress[lesson.id]?.completed) {
                    statusEl.innerHTML = `<i data-feather="check" class="w-4 h-4 text-green-400"></i>`;
                    statusEl.classList.add('bg-green-500/20', 'border-green-500');
                } else {
                    statusEl.innerHTML = ``;
                    statusEl.classList.remove('bg-green-500/20', 'border-green-500');
                }
            });
            feather.replace();
        };

        // --- 5. AUTHENTICATION & STATE MANAGEMENT ---
        const authModal = document.getElementById('auth-modal');
        const loginView = document.getElementById('login-view');
        const signupView = document.getElementById('signup-view');
        
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                authModal.classList.add('hidden');
                userActions.innerHTML = `<div class="flex items-center gap-4">
                    <span class="text-sm hidden sm:block">${user.email}</span>
                    <button id="logout-btn" class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg text-sm">Logout</button>
                </div>`;
                document.getElementById('logout-btn').addEventListener('click', () => signOut(auth));
                
                // Fetch user progress
                const docRef = doc(db, "userProgress", user.uid);
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    userProgress = docSnap.data();
                } else {
                    userProgress = {};
                }
                renderDashboard();
            } else {
                currentUser = null;
                userProgress = {};
                userActions.innerHTML = `<button id="login-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg">Login / Sign Up</button>`;
                document.getElementById('login-btn').addEventListener('click', () => authModal.classList.remove('hidden'));
                renderDashboard();
            }
        });

        // Auth form event listeners
        document.getElementById('login-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            signInWithEmailAndPassword(auth, email, password).catch(err => {
                document.getElementById('login-error').textContent = err.message;
            });
        });

        document.getElementById('signup-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            createUserWithEmailAndPassword(auth, email, password).catch(err => {
                document.getElementById('signup-error').textContent = err.message;
            });
        });

        // Modal toggling
        document.getElementById('show-signup').addEventListener('click', () => { loginView.classList.add('hidden'); signupView.classList.remove('hidden'); });
        document.getElementById('show-login').addEventListener('click', () => { signupView.classList.add('hidden'); loginView.classList.remove('hidden'); });
        document.getElementById('close-modal').addEventListener('click', () => authModal.classList.add('hidden'));
        document.getElementById('home-link').addEventListener('click', (e) => { e.preventDefault(); renderDashboard(); });
    </script>
</body>
</html>

